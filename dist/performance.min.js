/*! Ringmark - v1.4.0pre - 7/31/2012
* Copyright ( c ) 2012 Facebook Licensed W3C 3-clause BSD License, W3C Test Suite License */
(function(a){function b(a){var c,d;a=a||{},this.view=a.view||"visible",this.mode=a.mode||0,this.options=a.options||{graph:!1,range:!1},this.fps={value:0,min:1e3,max:0,div:null,text:null,graph:null},this.ms={value:0,min:1e3,max:0,div:null,text:null,graph:null},c=Date.now(),this.time={start:c,prev:c},this.frames=0,this.container=b.createNode({props:{id:"stats",style:{cssText:"width:80px;opacity:0.9;cursor:pointer;position:absolute"}}}),this.fps.div=b.createNode({props:{id:"fps",style:{cssText:"padding:3px;text-align:left;background-color:#002"}}}),this.container.appendChild(this.fps.div),this.fps.text=b.createNode({props:{id:"fps.text",innerHTML:"FPS",style:{cssText:"color:#0ff;font-family:Helvetica;font-size:10px;font-weight:bold;line-height:15px"}}}),this.fps.div.appendChild(this.fps.text),this.ms.div=b.createNode({props:{id:"ms.value",style:{cssText:"padding:3px;text-align:left;background-color:#020;display:none"}}}),this.container.appendChild(this.ms.div),this.ms.text=b.createNode({props:{id:"ms.text",innerHTML:"MS",style:{cssText:"color:#0f0;font-family:Helvetica;font-size:10px;font-weight:bold;line-height:15px"}}}),this.ms.div.appendChild(this.ms.text);if(this.options.graph){this.fps.graph=b.createNode({props:{id:"fps.graph",style:{cssText:"position:relative;width:74px;height:30px;background-color:#0ff"}}}),this.fps.div.appendChild(this.fps.graph);while(this.fps.graph.children.length<74)this.fps.graph.appendChild(b.createNode({type:"span",props:{style:{cssText:"width:1px;height:30px;float:left;background-color:#113"}}}));this.ms.graph=b.createNode({props:{id:"ms.graph",style:{cssText:"position:relative;width:74px;height:30px;background-color:#0f0"}}}),this.ms.div.appendChild(this.ms.graph);while(this.ms.graph.children.length<74)this.ms.graph.appendChild(b.createNode({type:"span",props:{style:{cssText:"width:1px;height:30px;float:left;background-color:#131"}}}))}document.body.appendChild(this.container),d=this,this.container.addEventListener("mousedown",function(a){a.preventDefault(),d.setMode(++d.mode%2)},!1),this.setMode(this.mode),this.setView(this.view),this.panel=this.container}function c(a,b){return Object.keys(b).forEach(function(b){var d=this[b];typeof d=="object"&&!Array.isArray(d)?c(a[b],d):a[b]=d},b),a}b.prototype.get=function(a){var b=this[a];return b&&{value:b.value,max:b.max,min:b.min}},b.prototype.setView=function(a){return this.view=a,this.container.style.visibility=a,this},b.prototype.setMode=function(a){return this.mode=a,this.fps.div.style.display=this.mode?"none":"block",this.ms.div.style.display=this.mode?"block":"none",this},b.prototype.begin=function(){return this.time.start=Date.now(),this},b.prototype.update=function(){return this.time.start=this.end(),this},b.prototype.end=function(){var a,b,c,d;return a=Date.now(),b=this.ms,c=this.fps,this.ms.value=a-this.time.start,this.ms.min=Math.min(this.ms.min,this.ms.value),this.ms.max=Math.max(this.ms.max,this.ms.value),d=this.ms.value+" MS",this.options.range&&(d+=" ("+this.ms.min+"-"+this.ms.max+")"),this.ms.text.textContent=d,this.options.graph&&this.graph(this.ms.graph,Math.min(30,30-this.ms.value/200*30)),this.frames++,a>this.time.prev+1e3&&(this.fps.value=Math.round(this.frames*1e3/(a-this.time.prev)),this.fps.min=Math.min(this.fps.min,this.fps.value),this.fps.max=Math.max(this.fps.max,this.fps.value),d=this.fps.value+" FPS",this.options.range&&(d+=" ("+this.fps.min+"-"+this.fps.max+")"),this.fps.text.textContent=d,this.options.graph&&this.graph(this.fps.graph,Math.min(30,30-this.fps.value/100*30)),this.time.prev=a,this.frames=0),a},b.prototype.graph=function(a,b){var c;return a&&(c=a.appendChild(a.firstChild),c.style.height=b+"px"),this},b.createNode=function(a){return a.type||(a.type="div"),c(document.createElement(a.type),a.props)},a.Moxie=b})(this),window.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function a(b,c){var d,e;window.setTimeout(function(){d=+(new Date),b(d),e=+(new Date),a.timeout=1e3/60-(e-d)},a.timeout)},function(a){function b(a){if(!a)throw new Error("Cannot create new Renderer without src");this.image=new Image,this.image.src=a}function c(a,c){this.entity=new b(a),this.cells=c||[],this.index=0}function d(a){var b,d;if(!a.context)throw new Error("Cannot create new Sprite without canvas context");this.name=a.name,this.sheet=new c(a.src,a.cells),this.context=a.context,this.reference=this.sheet.entity.image,this.frames=a.frames,a.bounds=b=a.bounds||{},this.bounds={left:b.left||0,top:b.top||0,width:b.width||0,height:b.height||0},a.velocity=d=a.velocity||{},this.velocity={x:d.x||0,y:d.y||0},this.visible=!0,this.animating=!1}b.prototype={render:function(a,b,c){try{c.drawImage(this.image,a.left,a.top,a.width,a.height,b.left,b.top,a.width,a.height)}catch(d){}return this}},c.prototype={next:function(){return this.index===this.cells.length-1?this.index=0:this.index++,this},render:function(a,b){return this.entity.render(this.cells[this.index],a.bounds,b),this}},d.prototype={render:function(){return this.visible&&this.sheet.render(this,this.context),this},update:function(a){var b=this.frames.length;while(b)this.frames[b-1].action(this,this.context,a),b--;return this}},a.Renderer=b,a.Sheet=c,a.Sprite=d}(this);